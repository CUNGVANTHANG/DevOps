## Docker

Docker l√† c√¥ng c·ª• gi√∫p b·∫°n ƒë√≥ng g√≥i ·ª©ng d·ª•ng k√®m m√¥i tr∆∞·ªùng ch·∫°y (nh∆∞ Node, Python, DB, OS...) v√†o m·ªôt "h·ªôp" g·ªçi l√† container, ƒë·ªÉ:

üëâ Ch·∫°y ·ªü ƒë√¢u c≈©ng ƒë∆∞·ª£c, kh√¥ng lo l·ªách m√¥i tr∆∞·ªùng gi·ªØa m√°y dev, test, hay production.

## M·ª•c l·ª•c

<details>
  <summary>C√°ch Docker ho·∫°t ƒë·ªông</summary>

- [1. Ki·∫øn tr√∫c Docker](#1-ki·∫øn-tr√∫c-docker)
- [2. C√°c th√†nh ph·∫ßn c∆° b·∫£n c·ªßa Docker](#2-c√°c-th√†nh-ph·∫ßn-c∆°-b·∫£n-c·ªßa-docker)

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |
| 1 | `docker ps` | Li·ªát k√™ c√°c container ƒëang ch·∫°y |
| 2 | `docker pull` | Pull (download) m·ªôt docker image |
| 3 | `docker version` | Show version c·ªßa Docker client, Docker host |
| 4 | [`docker info`](#docker-info) | Show ra c√°c th√¥ng tin c·ªßa docker client v√† docker host |
| 5 | [`whereis`](#whereis) | T√¨m location n∆°i ch·ª©a file binary c·ªßa ch∆∞∆°ng tr√¨nh |
| 6 | docker login | Login v√†o docker hub |
  
</details>
</details>

<details>
  <summary>Docker container</summary>

- [1. C·∫•u tr√∫c l·ªánh](#1-c·∫•u-tr√∫c-l·ªánh)
- [2. Image vs Container](#2-image-vs-container)
- [3. Container vs Virtual Machine](#3-container-vs-virtual-machine)
- [4. B√†i t·∫≠p](#4-b√†i-t·∫≠p)
- [5. T·∫°o Redis container t·ª´ DockerHub](#5-t·∫°o-redis-container-t·ª´-dockerhub)
- [6. T·∫°o container t·ª´ image](#6-t·∫°o-container-t·ª´-image)

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |
| 1 | [`docker container run`](#docker-container-run) | T·∫°o docker container | 
| 2 | `docker container logs [name_container]` | Log container |
| 3 | `docker container exec -it [name_container] bash` | Truy c·∫≠p v√†o container s·ª≠ d·ª•ng c√¢u l·ªánh gi·ªëng Ubuntu |
| 4 | `docker container --help` | Xem h∆∞·ªõng d·∫´n c√°c c√¢u l·ªánh container |
| 5 | `docker container stats [name_container]` | Xem c√°c th√¥ng s·ªë trong container |
| 6 | `docker container inspect [name_container]` | Xem th√¥ng tin chi ti·∫øt c·ªßa container |
| 7 | `docker container diff [name_container]` | Xem c√°c writable layer trong container |
| 8 | `docker container prune` | X√≥a t·∫•t c·∫£ c√°c container ·ªü tr·∫°ng th√°i Stopped |
| 9 | [`netstat -plunt`](#netstat--plunt) | Xem tr·∫°ng th√°i c·ªßa c√°c port (c·ªïng) tr√™n h·ªá th·ªëng |
  
</details>
</details>

<details>
  <summary>Docker image</summary>

- [1. Docker image l√† g√¨](#1-docker-image-l√†-g√¨)
- [2. Dockerfile](#2-dockerfile)
- [3. T·∫°o Docker image t·ª´ Docker container](#3-t·∫°o-docker-image-t·ª´-docker-container)
- [4. Ph√¢n ph·ªëi, chia s·∫ª Docker image b·∫±ng Docker registry](#4-ph√¢n-ph·ªëi-chia-s·∫ª-docker-image-b·∫±ng-docker-registry)
- [5. Ph√¢n ph·ªëi, chia s·∫ª Docker image b·∫±ng file TAR](#5-ph√¢n-ph·ªëi-chia-s·∫ª-docker-image-b·∫±ng-file-tar)

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |
| 1 | [`docker image ls`](#docker-image-ls) | Li·ªát k√™ c√°c image v√† dung l∆∞·ª£ng c·ªßa n√≥ | 
| 2 | `docker network create [name_network]` |  T·∫°o m√¥i tr∆∞·ªùng ƒë·ªÉ c√°c container giao ti·∫øp v·ªõi nhau th√¥ng qua container name | 
| 3 | [`docker image history`](#docker-image-history) |Xem c√°c layer c·ªßa docker image |
| 4 | [`docker image build`](#docker-image-build) | Build dockerfile (T·∫°o docker image t·ª´ Dockerfile) |
| 5 | [`docker container commit`](#docker-container-commit) | T·∫°o docker image t·ª´ docker container |
| 6 | [`docker image tag`](#docker-image-tag) | Thay ƒë·ªïi t√™n, tag c·ªßa m·ªôt docker image | 
| 7 | `docker image push [image or account/image]` | Push image l√™n docker hub | 
| 8 | `docker image rm [image or account/image]:[tag]` | X√≥a image t·∫°i local | 
| 9 | `docker image pull [image or account/image]` | Pull image t·ª´ docker hub | 

</details>
</details>

<details>
  <summary>Docker volume</summary>

- [1. Persistent Data](#1-persistent-data)
- [2. Bind Mount](#2-bind-mount)
- [3. V√≠ d·ª• v·ªÅ Bind Mount](#3-v√≠-d·ª•-v·ªÅ-bind-mount)
- [4. Volume l√† g√¨](#4-volume-l√†-g√¨)
- [5. V√≠ d·ª• v·ªÅ Volume](#5-v√≠-d·ª•-v·ªÅ-volume)
- [6. Bind mount vs Volume](#6-bind-mount-vs-volume)
- [7. Utility containers](#7-utility-containers)

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |
| 1 | [`docker container run -v`](#4-volume-l√†-g√¨) | T·∫°o container c√≥ volume |
| 2 | `docker volume ls` | Li·ªát k√™ c√°c volume |
| 3 | `docker volume inspect [volume_name]` |  Xem th√¥ng tin chi ti·∫øt c·ªßa volume | 
| 4 | `docker volume rm [volume_name]` | X√≥a volume c√≥ t√™n l√† volume_name | 
| 5 | [`docker container run --volumes-from [container_name]`](#5-v√≠-d·ª•-v·ªÅ-volume) | T·∫°o docker m·ªõi c√≥ t·∫•t c·∫£ volume c·ªßa docker container_name |

</details>
</details>

<details>
  <summary>Docker network</summary>

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |

</details>
</details>

<details>
  <summary>Docker compose</summary>

<details>
  <summary>Danh s√°ch l·ªánh</summary>

| STT | L·ªánh | T√°c d·ª•ng |
| :--: | :--: | :--: |

</details>
</details>

## I. C√°ch Docker ho·∫°t ƒë·ªông
### 1. Ki·∫øn tr√∫c Docker
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Ki·∫øn tr√∫c Docker g·ªìm: **docker client**, **docker host**, **docker registry**

- Docker client: **nh·∫≠n l·ªánh t·ª´ user** (V√≠ d·ª•: `docker run`, `docker pull`... v√† g·ª≠i ƒë·∫øn host)
- Docker host: x·ª≠ l√Ω l·ªánh, **qu·∫£n l√Ω docker object** (container, image, volume,...) k·∫øt n·ªëi v·ªõi docker registry ƒë·ªÉ pull/push c√°c docker image
- Docker registry: **l∆∞u tr·ªØ**, ph√¢n ph·ªëi c√°c docker image. VD: DockerHub

#### docker info
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Show ra c√°c th√¥ng tin c·ªßa docker client v√† docker host

![image](https://github.com/user-attachments/assets/a1ed08ae-de05-4c42-857c-0512e628f571)

#### whereis 
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

T√¨m location n∆°i ch·ª©a file binary c·ªßa ch∆∞∆°ng tr√¨nh

N∆°i ch·ª©a docker client:

```
whereis docker
```

N∆°i ch·ª©a docker host:

```
whereis dockerd
```

_Ch√∫ √Ω:_

Docker client v√† docker host c√≥ th·ªÉ n·∫±m c√πng m·ªôt m√°y ho·∫∑c kh√¥ng. N·∫øu kh√¥ng, docker client s·∫Ω connect t·ª´ xa ƒë·∫øn docker daemon c·ªßa docker host

Ta c√≥ th·ªÉ t·ª± setup Docker registry c·ªßa d·ª± √°n m√† kh√¥ng c·∫ßn ph·∫£i l·ª±a ch·ªçn DockerHub l√†m Docker registry duy nh·∫•t

### 2. C√°c th√†nh ph·∫ßn c∆° b·∫£n c·ªßa Docker
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Docker container l√† m√¥i tr∆∞·ªùng ch·∫°y ƒë·ªôc l·∫≠p cho application

Docker image l√† file template ƒë·ªÉ t·∫°o ra docker container

M·ªôt docker image c√≥ th·ªÉ t·∫°o ra nhi·ªÅu docker container, nh∆∞ng m·ªôt docker container ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c t·∫°o ra m·ªôt docker image.

## II. Docker container
### 1. C·∫•u tr√∫c l·ªánh
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

```
docker <object> <command> <option>
```

Trong ƒë√≥:

- object: l√† c√°c ƒë·ªëi t∆∞·ª£ng nh∆∞: `container`, `image`, `volume`, `network`, `system`
- command: l√† c√°c c√¢u l·ªánh s·ª≠ d·ª•ng cho c√°c object
- option: l√† c√°c tham s·ªë c·ªßa command

_V√≠ d·ª•:_

```
docker container run -d --name my-mongo -p 27017:27017 mongo:latest
```

Trong ƒë√≥:

- object l√† `container`
- command l√† `run`
- option l√† `-d --name my-mongo -p 27017:27017 mongo:latest`

### 2. Image vs Container
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Docker image l√† file template t·∫°o ra container

Container l√† m√¥i tr∆∞·ªùng ·∫£o h√≥a ƒë·ªôc l·∫≠p, ho√†n ch·ªânh: ch·ª©a ch∆∞∆°ng tr√¨nh v√† c√°c g√≥i b·ªï sung

Container **b·∫£n ch·∫•t l√† m·ªôt process** tr√™n h·ªá th·ªëng

![image](https://github.com/user-attachments/assets/0906e10a-a4e2-484a-bd48-26c60047f8e4)

#### docker container run
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

_V√≠ d·ª• 1:_ Trong ƒë√≥ `my-nginx` l√† t√™n container, `nginx` l√† t√™n image

```
docker container run --name my-nginx -p 80:80 nginx
```

Ho·∫°t ƒë·ªông nh∆∞ sau:

1. Ki·ªÉm tra local xem c√≥ image nginx hay kh√¥ng
2. N·∫øu kh√¥ng c√≥, l√™n Docker registry (m·∫∑c ƒë·ªãnh l√† DockerHub) ƒë·ªÉ pull image v·ªÅ
3. T·∫°o container d·ª±a tr√™n image v·ª´a pull
4. T·∫°o virtual IP cho container
5. M·ªü port 80 tr√™n m√°y host v√† bind n√≥ v·ªõi port 80 c·ªßa container
6. Ch·∫°y ch∆∞∆°ng tr√¨nh ch√≠nh b√™n trong container

> [!NOTE]
> - `--publish` l√† t√™n ƒë·∫ßy ƒë·ªß c·ªßa `-p` option
> - 80:80 : b√™n tr√°i l√† port c·ªßa host, b√™n ph·∫£i l√† port c·ªßa container
> - nginx: khi kh√¥ng c√≥ tag, m·∫∑c ƒë·ªãnh s·∫Ω l√† **latest**

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/89ba96de-ea0a-4762-8ed3-45dae56e2375" width="300px">

<img src="https://github.com/user-attachments/assets/a30f9a3b-0d72-4bdc-9843-2b2ae9743fb1" width="300px">

_V√≠ d·ª• 2:_ Ta c√≥ th·ªÉ k·∫øt h·ª£p c√¢u l·ªánh t·∫°o container v√† c√¢u l·ªánh truy c·∫≠p v√†o container. Trong ƒë√≥ `new-container` l√† t√™n container, `new-ubuntu` l√† t√™n image

```
docker container run --name new-container -it new-ubuntu bash
```

### netstat -plunt
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

D√πng ƒë·ªÉ xem tr·∫°ng th√°i c·ªßa c√°c port (c·ªïng) tr√™n h·ªá th·ªëng

<img src="https://github.com/user-attachments/assets/380973c5-99f7-4641-b88e-778e87f10054" width="400px">

_C√†i ƒë·∫∑t:_

```
sudo apt install net-tools
```

### 3. Container vs Virtual Machine
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Virtual Machine l√† c√¥ng ngh·ªá ·∫£o h√≥a ·ªü m·ª©c ƒë·ªô s√¢u h∆°n: ·∫£o h√≥a c·∫£ ph·∫ßn c·ª©ng

M·ªôt VM t∆∞∆°ng ƒë∆∞∆°ng v·ªõi m·ªôt server ho√†n ch·ªânh: c√≥ ph·∫ßn c·ª©ng ri√™ng, OS ri√™ng, application ri√™ng

| ∆Øu ƒëi·ªÉm | Nh∆∞·ª£c ƒëi·ªÉm |
| :--: | :--: |
| M√¥i tr∆∞·ªùng ƒë·ªôc l·∫≠p cao | Ng·ªën nhi·ªÅu t√†i nguy√™n |
| T√≠nh b·∫£o m·∫≠t t·ªët h∆°n | Ch·∫≠m ch·∫°p |

> [!NOTE]
> Ph√π h·ª£p ƒë·ªÉ d·ª±ng m√¥i tr∆∞·ªùng ho√†n ch·ªânh ƒë·ªÉ tri·ªÉn khai / test application

### 4. B√†i t·∫≠p
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

- T·∫°o docker container cho c√°c ·ª©ng d·ª•ng: nginx, mysql, wordpress
- T·∫°o docker container cho c√°c ·ª©ng d·ª•ng: nginx, mysql, wordpress
- Nginx web server: ch·∫°y c·ªïng 81:80
- Mysql database: ch·∫°y c·ªïng 3307, password l√† "password123_DONG", database l√† "db_example"
- Wordpress website: ch·∫°y c·ªïng 8080, k·∫øt n·ªëi database ·ªü b√™n tr√™n

**L·ªùi gi·∫£i**

- **T·∫°o docker container cho c√°c ·ª©ng d·ª•ng: nginx, mysql, wordpress**
- **Nginx web server: ch·∫°y c·ªïng 81:80**

```
docker container run --name my-nginx -p 81:80 -d nginx
```

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/7e1ac87c-9bfb-4e2e-9841-9c83bab96b61" width="300px">

Ki·ªÉm tra b·∫±ng `docker container logs my-nginx` ƒë·ªÉ bi·∫øt r√µ h∆°n

- **Mysql database: ch·∫°y c·ªïng 3307, password l√† "password123_DONG", database l√† "db_example"**

Tham kh·∫£o t·∫°i: https://hub.docker.com/_/mysql

```
docker container run --name my-mysql -p 3307:3306 -e MYSQL_ROOT_PASSWORD=password123_DONG -e MYSQL_DATABASE=db_example -d mysql:latest
```

trong ƒë√≥ `-e` nghƒ©a l√† s·ª≠ d·ª•ng bi·∫øn c√≥ s·∫µn `MYSQL_ROOT_PASSWORD` v√† `MYSQL_DATABASE`

ƒê·ªÉ ki·ªÉm tra xem ƒë√£ th√†nh c√¥ng ch∆∞a ch√∫ng ta s·ª≠ d·ª•ng 

```
docker container exec -it my-mysql bash
```

Sau ƒë√≥ s·ª≠ d·ª•ng c√¢u l·ªánh sau v√† nh·∫≠p password l√† `password123_DONG`

```
mysql -u root -p
```

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/97ce5af5-3a8a-4db3-b5b2-3a4e125faf9d" width="500px">

- **Wordpress website: ch·∫°y c·ªïng 8080, k·∫øt n·ªëi database ·ªü b√™n tr√™n**

Tham kh·∫£o t·∫°i ƒë√¢y: https://hub.docker.com/_/wordpress

```
docker container run --name my-wordpress -p 8080:80 -d wordpress
```

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/afb1c834-4fc0-4051-b980-93ae7a4c086d" width="600px">

<img src="https://github.com/user-attachments/assets/e25cc482-5d39-4037-99fe-06cf6f12dbed" width="600px">

Sau ƒë√≥ ta th·ª±c hi·ªán k·∫øt n·ªëi v·ªõi database. 

<img src="https://github.com/user-attachments/assets/3ffe7188-29ff-41b7-9a9d-65e3b05170ff" width="400px">

L∆∞u √Ω r·∫±ng **Database Host** ta s·∫Ω l·∫•y ƒë·ªãa ch·ªâ IP c·ªßa mysql, b·∫±ng c√°ch th·ª±c hi·ªán

```
docker container inspect my-mysql
```

<img src="https://github.com/user-attachments/assets/ee00f98c-6842-42b4-bf44-e5a9030e49a8" width="400px">

### 5. T·∫°o Redis container t·ª´ DockerHub
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Tr∆∞·ªõc khi t·∫°o docker container ta s·∫Ω t·∫°o docker network tr∆∞·ªõc. Docker network l√† m√¥i tr∆∞·ªùng ƒë·ªÉ c√°c container giao ti·∫øp v·ªõi nhau th√¥ng qua container name. V√≠ d·ª•

```
docker network create test
```

Ti·∫øp theo ta kh·ªüi t·∫°o docker t√™n l√† `some-redis` b·∫±ng c√°ch

```
docker run --name some-redis -d --network test redis
```

C·∫ßn client ƒë·ªÉ g·ª≠i d·ªØ li·ªáu, ta c√†i ƒë·∫∑t

```
docker run -it --network test --rm redis redis-cli -h some-redis
```

ƒê·ªÉ c√≥ th·ªÉ ki·ªÉm tra ta ƒë√£ c√≥ th·ªÉ truy c·∫≠p ch∆∞a, s·ª≠ d·ª•ng c√¢u l·ªánh `ping` ƒë·ªÉ ki·ªÉm tra

### 6. T·∫°o container t·ª´ image
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√°ch t·∫°o r·∫•t ƒë∆°n gi·∫£n l√† t·∫°o th√™m layer m·ªõi l√™n tr√™n layer c·ªßa docker image (Docker th√™m 1 writable layer l√™n tr√™n c√°c image layers)

H√¨nh dung l√† image layers l√† c√°c layer read-only. ƒê·ªÉ c√≥ th·ªÉ t·∫°o container t·ª´ image ta ch·ªâ c·∫ßn th√™m writable layer l√™n tr√™n 

<img src="https://github.com/user-attachments/assets/25064556-e4ad-4137-899f-f6b37a9044f9" width="300px" >

<img src="https://github.com/user-attachments/assets/7073bffc-aa09-45f7-a865-375fc66baa97" width="300px" >

C√¢u l·ªánh s·ª≠ d·ª•ng [`docker container run`](#docker-container-run)

## III. Docker image
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

### 1. Docker image l√† g√¨
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Container l√† m·ªôt process, v·∫≠y ƒë·ªÉ ph√¢n ph·ªëi ƒë∆∞·ª£c container ƒë·∫øn nhi·ªÅu m√°y t√≠nh kh√°c nhau ch√∫ng ta c·∫ßn t·ªõi docker image 

Docker image l√†:

- L√† file app binaries + c√°c dependencies
- L√† template d√πng ƒë·ªÉ t·∫°o ra c√°c container
- Image kh√¥ng ch·ª©a OS ƒë·∫ßy ƒë·ªß. Kh√¥ng c√≥ kernel v√¨ n√≥ d√πng kernel c·ªßa m√°y host (VD: driver...)
- C√≥ th·ªÉ ch·ªâ l√† 1 file c√≥ dung l∆∞·ª£ng kh√° nh·ªè (VD alpine, busybox...)
- Ho·∫∑c 1 file c√≥ dung l∆∞·ª£ng l·ªõn (VD: mongodb, mysql, wordpress...)

> [!IMPORTANT]
> **3 c√°ch ƒë·ªÉ c√≥ Docker image**
>- DockerHub: Download docker image t·ª´ public registry
>- Dockerfile: T·∫°o docker image t·ª´ c√°c instruction trong Dockerfile
>- Docker container: Bi·∫øn writable layer th√†nh read only layer

> [!IMPORTANT]
> **2 c√°ch ƒë·ªÉ ph√¢n ph·ªëi, chia s·∫ª Docker image cho ng∆∞·ªùi kh√°c**
>- Docker Registry: D√πng l·ªánh pull/push ph√¢n ph·ªëi images l√™n Docker registry
>- TAR file: Chuy·ªÉn image th√†nh file TAR

### docker image ls
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Li·ªát k√™ c√°c image v√† dung l∆∞·ª£ng c·ªßa n√≥

<img src="https://github.com/user-attachments/assets/08f088d9-f89b-4e3b-975e-784c2d40ba87" width="400px">

_V√≠ d·ª•:_ V·ªÅ docker image

<img src="https://github.com/user-attachments/assets/90b017fe-e35b-40d4-9d91-74a6952efce7" width="300px">

File microsoft word khi c√†i ƒë·∫∑t tr√™n m√°y s·∫Ω ng·ªën 1.5GB tr√™n ·ªï c·ª©ng c·ªßa ta. Khi m√† ta s·ª≠ d·ª•ng ch∆∞∆°ng tr√¨nh microsoft word ƒë·ªÉ so·∫°n th·∫£o vƒÉn b·∫£n th√¨ n√≥ s·∫Ω ng·ªën 1 l∆∞·ª£ng t√†i nguy√™n kh√°c c·ªßa ch∆∞∆°ng tr√¨nh l√† CPU v√† RAM

<img src="https://github.com/user-attachments/assets/8767c162-e144-4854-bc2e-ddf4484f676e" width="300px">

T∆∞∆°ng t·ª± docker image gi·ªëng nh∆∞ file microsoft word chi·∫øm 1 dung l∆∞·ª£ng nh·∫•t ƒë·ªãnh. Khi m√† docker t·∫°o docker container t·ª´ docker image th√¨ n√≥ s·∫Ω ng·ªën CPU v√† RAM (v√¨ n√≥ l√† file template n√™n n√≥ c√≥ th·ªÉ t·∫°o ra nhi·ªÅu docker container nh∆∞ng v·∫´n s·∫Ω ch·∫°y ƒë·ªôc l·∫≠p tr√™n m√°y host)

#### C·∫•u tr√∫c c·ªßa Docker Image
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Image t·∫°o b·ªüi 1 chu·ªói layers. M·ªói layer l√† m·ªôt s·ª± thay ƒë·ªïi tr√™n file system

**File system?**

- L√† c√°ch m√† non-volatile data ƒë∆∞·ª£c l∆∞u tr·ªØ, qu·∫£n l√Ω tr√™n c√°c storage devices
  - VD: FAT, NTFS, ext...

> [!NOTE]
> - **non-volatile data** l√† d·ªØ li·ªáu kh√¥ng b·ªã m·∫•t ƒëi khi ng·∫Øt ngu·ªìn ƒëi·ªán
> - **volatile data** l√† d·ªØ li·ªáu l∆∞u tr√™n RAM, cache s·∫Ω b·ªã m·∫•t khi ng·∫Øt ngu·ªìn ƒëi·ªán

Docker s·ª≠ d·ª•ng file kh√° l√† ƒë·∫∑c bi·ªát ƒë√≥ l√† union file system

**Union File System?**

- C√°c layer x·∫øp ch·ªìng l√™n nhau theo tr√¨nh t·ª± t·ª´ d∆∞·ªõi l√™n tr√™n
- Layer b√™n tr√™n s·∫Ω k·∫ø th·ª´a layer b√™n d∆∞·ªõi
- T·∫•t c·∫£ layer trong image ƒë·ªÅu l√† read-only

T∆∞∆°ng t·ª± nh∆∞ v·∫≠y

```
FROM node:18-alpine            -> Base image
WORKDIR /app                   -> Layer 1
COPY . .                       -> Layer 2
RUN yarn install --production  -> Layer 3
CMD ["node", "src/index.js"    -> Layer 4
EXPOSE 3000                    -> Layer 5
```

### docker image history
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√¢u l·ªánh s·ª≠ d·ª•ng ƒë·ªÉ xem ƒë∆∞·ª£c c√°c layer c·ªßa docker image

_V√≠ d·ª•:_

```
docker image history redis:latest
```

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/c264c13f-926d-48c4-91ca-876845b9e4ac" width="500px" >

N·∫øu ta c·ªông t·∫•t c·∫£ k√≠ch th∆∞·ªõc ·ªü ƒë√¢y s·∫Ω ra ƒë∆∞·ª£c k√≠ch th∆∞·ªõc th·∫≠t c·ªßa docker image

### 2. Dockerfile
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

- L√† b·∫£n thi·∫øt k·∫ø t·∫°o ra Docker image
- Ch·ª©a c√°c ch·ªâ d·∫´n (intructions) cho docker daemon
- M·ªôt Dockerfile ph·∫£i b·∫Øt ƒë·∫ßu v·ªõi ch·ªâ d·∫´n "FROM"

_V√≠ d·ª•:_

<img src="https://github.com/user-attachments/assets/fd1e78f5-83fb-4757-88fb-d988bd9761a0" width="300px" >

_Gi·∫£i th√≠ch l·ªánh:_

```
FROM node:18-alpine            -> Base image
WORKDIR /app                   -> Th∆∞ m·ª•c ch√≠nh
COPY . .                       -> Copy th∆∞ m·ª•c hi·ªán t·∫°i v√†o th∆∞ m·ª•c ch√≠nh c·ªßa container
RUN yarn install --production  -> Ch·∫°y command b√™n trong container
CMD ["node", "src/index.js"    -> L·ªánh/ch∆∞∆°ng tr√¨nh ƒë∆∞·ª£c ch·∫°y khi container start
EXPOSE 3000                    -> M·ªü c·ªïng tr√™n container
```

Tham kh·∫£o th√™m t·∫°i: https://docs.docker.com/reference/dockerfile/

**Cached layers**

Docker c·ªë g·∫Øng s·ª≠ d·ª•ng l·∫°i c√°c layer ƒë√£ t·∫°o tr∆∞·ªõc ƒë√≥

V√† build l·∫°i to√†n b·ªô t·ª´ layer ƒë·∫ßu ti√™n b·ªã thay ƒë·ªïi

_V√≠ d·ª•:_

<img src="https://github.com/user-attachments/assets/fd1e78f5-83fb-4757-88fb-d988bd9761a0" width="300px" >

Hi·ªÉu ƒë∆°n gi·∫£n n·∫øu layer 3 c√≥ s·ª± thay ƒë·ªïi th√¨ c√°c layer ·ªü ph√≠a tr√™n s·∫Ω ƒë∆∞·ª£c caching l·∫°i nghƒ©a l√† kh√¥ng c·∫ßn ph·∫£i t·∫°o m·ªõi m√† ƒë∆∞·ª£c s·ª≠ d·ª•ng lu√¥n. N√≥ s·∫Ω build t·ª´ layer 3 xu·ªëng c√°c layer d∆∞·ªõi

**K·ªπ thu·∫≠t t·ªëi ∆∞u h√≥a qu√° tr√¨nh build**

T·∫°i sao ph·∫£i t·ªëi ∆∞u h√≥a qu√° tr√¨nh build. ƒê∆°n gi·∫£n l√† ƒë·ªÉ ƒë·ª° m·∫•t th·ªùi gian

**C√°ch 1**: Chuy·ªÉn nh·ªØng instruction d√πng chung cho m·ªçi l·∫ßn build (VD update OS, c√†i ƒë·∫∑t ch∆∞∆°ng tr√¨nh...) l√™n tr∆∞·ªõc ƒë·ªÉ t·∫≠n d·ª•ng kh·∫£ nƒÉng cache c·ªßa Docker

### docker image build
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

D√πng ƒë·ªÉ build dockerfile (T·∫°o docker image t·ª´ Dockerfile).

C√∫ ph√°p:

```
docker image build -t <tag> <context>
```

Docker s·ª≠ d·ª•ng Dockerfile v√† **build context** ƒë·ªÉ build image. Build context l√† m√¥i tr∆∞·ªùng cung c·∫•p file c·∫ßn thi·∫øt ƒë·ªÉ docker build. C√≥ th·ªÉ l√† local filesystem, git repository,... C√¢u l·ªánh build c√≥ th·ªÉ truy c·∫≠p v√†o b·∫•t c·ª© file n√†o n·∫±m trong context

_V√≠ d·ª•:_ Build dockerfile c√≥ t√™n l√† `Dockerfile` ta th·ª±c hi·ªán c√¢u l·ªánh sau. `demo` l√† t√™n docker image, d·∫•u `.` nghƒ©a l√† build t·∫°i v·ªã tr√≠ hi·ªán t·∫°i l√† th∆∞ m·ª•c demo

C·∫•u tr√∫c th∆∞ m·ª•c:

```
demo
‚îú‚îÄ‚îÄ demo
‚îî‚îÄ‚îÄ Dockerfile
```

File `Dockerfile`:

```dockerfile
FROM ubuntu:latest
RUN apt update -y && apt update -y
COPY . .
CMD ["tail", "-f", "/dev/null"]
```

Th·ª±c hi·ªán c√¢u l·ªánh ƒë·ªÉ build docker image:

```
docker image build -t demo -f Dockerfile .
```

Sau khi ho√†n th√†nh ta c√≥ th·ªÉ th·ª±c hi·ªán 

```
docker container run --name demo -it demo bash
```

Xong ƒë√≥ s·ª≠ d·ª•ng c√¢u l·ªánh `ls` ƒë·ªÉ xem k·∫øt qu·∫£. T·∫•t c·∫£ file trong th∆∞ m·ª•c demo ƒë·ªÅu c√≥ trong container

N·∫øu file `demo` b·ªã thay ƒë·ªïi th√¨ ch·ªâ ch·∫°y l·∫°i layer t·∫°i `COPY . .` xu·ªëng c√°c layer ph√≠a d∆∞·ªõi tr√°nh ƒë∆∞·ª£c m·∫•t th·ªùi gian build l·∫°i t·ª´ ƒë·∫ßu

**C√°ch 2**: D√πng small base image

Small base image ·ªü ƒë·∫•y l√† c√°c image c√≥ k√≠ch th∆∞·ªõc nh·ªè (Tham kh·∫£o t·∫°i DockerHub). ƒêi·ªÉn h√¨nh l√† `alpine`

**C√°ch 3**: D√πng `.dockerignore` file ƒë·ªÉ gi·∫£m ƒëi k√≠ch th∆∞·ªõc c·ªßa docker image

_V√≠ d·ª•:_ Ta c√≥ c·∫•u tr√∫c th∆∞ m·ª•c sau

```
demo
‚îú‚îÄ‚îÄ useless_folder
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ .dockerignore
```

B√¢y gi·ªù ta mu·ªën b·ªè qua th∆∞ m·ª•c `useless_folder` trong qu√° tr√¨nh build ta l√†m nh∆∞ sau:

```dockerignore
/useless_folder
```

**C√°ch 4:** S·ª≠ d·ª•ng Multi-stage build

_V√≠ d·ª• minh h·ªça:_

```dockerfile
# syntax=docker/dockerfile:1
FROM golang:1.21
WORKDIR /src
COPY <<EOF ./main.go
package main

import "fmt"

func main() {
  fmt.Println("hello, world")
}
EOF
RUN go build -o /bin/hello ./main.go

FROM scratch
COPY --from=0 /bin/hello /bin/hello
CMD ["/bin/hello"]
```

Hi·ªÉu ƒë∆°n gi·∫£n nh∆∞ sau, ta c√≥ Stage 1 l√† 

```dockerfile
# syntax=docker/dockerfile:1
FROM golang:1.21
WORKDIR /src
COPY <<EOF ./main.go
package main

import "fmt"

func main() {
  fmt.Println("hello, world")
}
EOF
RUN go build -o /bin/hello ./main.go
```

Stage 2 s·∫Ω l√†:

```dockerfile
FROM scratch
COPY --from=0 /bin/hello /bin/hello
CMD ["/bin/hello"]
```

Th√¨ c√°ch ho·∫°t ƒë·ªông l√† state 1 s·∫Ω l√† input cho state 2 ƒë√≥ng g√≥i th√†nh container

<img src="https://github.com/user-attachments/assets/9c4173cd-6fcb-46ab-ac21-4ea4d7cf65da" width="500px" >

### 3. T·∫°o Docker image t·ª´ Docker Container
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√°ch ƒë·ªÉ t·∫°o Docker image t·ª´ Docker Container ta s·∫Ω bi·∫øn writable layer th√†nh read only layer

### docker container commit
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√∫ ph√°p: 

```
docker container commit <container> <image>
```

<img src="https://github.com/user-attachments/assets/719873aa-cb4e-4e11-9581-19a35ac88541" width="500px" >

_V√≠ d·ª•:_

```
docker container commit my-container new-image
```

### 4. Ph√¢n ph·ªëi, chia s·∫ª Docker image b·∫±ng Docker registry
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

ƒê·ªÉ c√≥ th·ªÉ l√†m ƒëi·ªÅu ƒë√≥ ta s·∫Ω d√πng l·ªánh pull/push ph√¢n ph·ªëi images l√™n Docker registry. Ta c·∫ßn ƒëƒÉng nh·∫≠p v√†o 
https://hub.docker.com/, ho·∫∑c s·ª≠ d·ª•ng Docker Desktop ƒë·ªÉ ƒëƒÉng nh·∫≠p

<img src="https://github.com/user-attachments/assets/c7de7d35-4bf6-43d6-9d1c-5209786ee4b7" width="500px" >

Sau ƒë√≥ s·ª≠ d·ª•ng c√¢u l·ªánh sau ƒë·ªÉ ƒëƒÉng nh·∫≠p

```
docker login
```

- [!NOTE]
- **Tr∆∞·ªõc khi ƒë·∫©y image c·ªßa ch√∫ng ta l√™n docker hub, ta c·∫ßn ƒë·ªïi t√™n image:tag th√†nh [account_name]/image:tag**

### docker image tag
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

D√πng ƒë·ªÉ thay ƒë·ªïi t√™n, tag c·ªßa docker image

C√∫ ph√°p:

```
docker image tag <source>:<tag> <target>:<tag>
```

_V√≠ d·ª•:_

<img src="https://github.com/user-attachments/assets/54086f13-e08d-4658-815e-f8304be9c4d1" width="300px" >

Ta s·ª≠ d·ª•ng `docker image tag` trong ƒë√≥ `cungvanthang` ch√≠nh l√† t√™n account c·ªßa ta

```
docker image tag redis:latest cungvanthang/redis:latest
```

<img src="https://github.com/user-attachments/assets/5659488c-4197-4276-880f-50421c97fd90" width="300px" >

Ti·∫øp theo ta s·ª≠ d·ª•ng c√¢u l·ªánh `docker image push`

```
docker image push cungvanthang/redis
```

<img src="https://github.com/user-attachments/assets/4f3581f2-2d66-4a1c-a9b3-9506e2166406" width="300px" >

_K·∫øt qu·∫£:_

<img src="https://github.com/user-attachments/assets/20269c89-6c4c-4081-b34a-c231c7524974" width="300px" >

### 5. Ph√¢n ph·ªëi, chia s·∫ª Docker image b·∫±ng file TAR
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

ƒê·ªÉ c√≥ th·ªÉ l√†m ƒëi·ªÅu ƒë√≥ ta s·∫Ω convert image th√†nh file TAR

### docker image save
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√∫ ph√°p:

```
docker image save [image or name_account/image] -o file.taz
```

_V√≠ d·ª•:_ Trong ƒë√≥ `redis` l√† t√™n image, `redis.taz` l√† t√™n file ta mu·ªën ƒë·∫∑t t√™n

```
docker image save redis -o redis.taz
```

<img src="https://github.com/user-attachments/assets/0b5ab84b-dc99-46f0-b13a-36f24dbc67c8" width="500px" >

Ta c√≥ th·ªÉ th·∫•y ƒë∆∞·ª£c file `redis.taz` ƒë√£ ƒë∆∞·ª£c convert t·ª´ image. B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ g·ª≠i file n√†y cho b·∫°n b√® ho·∫∑c ng∆∞·ªùi kh√°c

Dƒ© nhi√™n, b·∫°n b√® ho·∫∑c ng∆∞·ªùi kh√°c ƒë·ªÉ c√≥ th·ªÉ load ƒë∆∞·ª£c file `redis.taz` ƒë√≥ th√¨ s·∫Ω s·ª≠ d·ª•ng c√¢u l·ªánh sau:

### docker image load
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

C√∫ ph√°p:

```
docker image load -i [name_file.taz]
```

_V√≠ d·ª•:_ Trong ƒë√≥ `redis.taz` ch√≠nh l√† file `.taz` ta mu·ªën load

```
docker load -i redis.taz 
```

<img src="https://github.com/user-attachments/assets/d6cd10e3-154d-40b5-9b76-a438f974aefd" width="500px" >

### 6. B√†i t·∫≠p
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

1. ƒê√≥ng g√≥i Docker image cho ch∆∞∆°ng tr√¨nh Java Spring Boot
2. ƒê√≥ng g√≥i Docker image cho ch∆∞∆°ng tr√¨nh Python Django
3. ƒê√≥ng g√≥i Docker image cho ch∆∞∆°ng tr√¨nh NodeJS

**L·ªùi gi·∫£i:**

#### 1. ƒê√≥ng g√≥i Docker image cho ch∆∞∆°ng tr√¨nh Java Spring Boot

ƒê·∫ßu ti√™n ƒë·ªÉ c√≥ th·ªÉ t·∫°o ra 1 project cho ch∆∞∆°ng tr√¨nh Java Spring Boot, ta l√™n [https://start.spring.io/](https://start.spring.io/) ƒë·ªÉ c√†i ƒë·∫∑t c√°c dependencies v√† ch·ªçn **Generate** ƒë·ªÉ t·∫£i xu·ªëng

<img src="https://github.com/user-attachments/assets/49d34d3d-bc6b-4c2c-a03f-05068a961bf2" width="500px" >

Ch√∫ng ta s·∫Ω ƒë∆∞·ª£c project nh∆∞ sau:

<img src="https://github.com/user-attachments/assets/d27fe140-e806-47cb-a012-2f81ad5d1138" width="500px" >

Ch√∫ng ta s·∫Ω b·∫Øt ƒë·∫ßu v·ªõi d·ª± √°n ƒë·∫ßu ti√™n cho project n√†y r·ªìi s·∫Ω ƒë√≥ng g√≥i n√≥ l·∫°i...

B·∫Øt ƒë·∫ßu ch∆∞∆°ng tr√¨nh ƒë·∫ßu ti√™n t·∫°i [https://spring.io/guides/gs/spring-boot](https://spring.io/guides/gs/spring-boot). B·∫±ng c√°ch t·∫°o ch∆∞∆°ng tr√¨nh Hello World ƒë·∫ßu ti√™n

<img src="https://github.com/user-attachments/assets/a299c38b-d678-4612-85f8-19cf73442b63" width="500px" >

Tr∆∞·ªõc ti√™n ta s·∫Ω ch·∫°y ch∆∞∆°ng tr√¨nh t·∫°i localhost tr∆∞·ªõc khi ƒë√≥ng g√≥i 

S·ª≠ d·ª•ng c√¢u l·ªánh t·∫°i th∆∞ m·ª•c demo

```
mvn clean package
```

<img src="https://github.com/user-attachments/assets/c708a4c0-819e-4ad7-ac5e-5f435d290b79" width="500px" >

Ti·∫øp theo s·ª≠ d·ª•ng c√¢u l·ªánh 

```
java -jar target/demo-0.0.1-SNAPSHOT.jar
```

<img src="https://github.com/user-attachments/assets/8b067645-644f-4cc4-88ef-8371c7d63062" width="500px" >


**K·∫øt qu·∫£:**

![image](https://github.com/user-attachments/assets/9c765449-2f94-4b39-8570-5f1de65d2fe3)

**ƒê√≥ng g√≥i**

ƒê·ªÉ c√≥ th·ªÉ ƒë√≥ng g√≥i, ch√∫ng ta c·∫ßn t·∫°o `Dockerfile` v·ªõi n·ªôi dung nh∆∞ sau:

```dockerfile
FROM maven:3.9.4-eclipse-temurin-17-alpine AS build
WORKDIR /app
COPY . .
RUN mvn clean package

FROM openjdk:17-alpine
COPY --from=build /app/target/demo-0.0.1-SNAPSHOT.jar app.jar
CMD ["java", "-jar", "app.jar"]
```

ƒê·ªìng th·ªùi t·∫°o th√™m file `.dockerignore` ƒë·ªÉ lo·∫°i b·ªè th∆∞ m·ª•c m√† ta kh√¥ng mu·ªën ƒë√≥ng g√≥i. ·ªû ƒë√¢y t√¥i kh√¥ng mu·ªën ƒë√≥ng g√≥i th∆∞ m·ª•c `target`

```
./target
```

Th·ª±c hi·ªán c√¢u l·ªánh ƒë·ªÉ ti·∫øn h√†nh ƒë√≥ng g√≥i

```
docker image build -t springboot-demo .
```

**K·∫øt qu·∫£:**

<img src="https://github.com/user-attachments/assets/6fff7a14-0f28-4fa1-92ca-f676c71a238c" width="500px" >

## IV. Docker volume
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

### 1. Persistent Data
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

**T·∫°i sao c·∫ßn Persistent Data?**

> **Container ƒë∆∞·ª£c thi·∫øt k·∫ø r·∫•t nh·ªè g·ªçn ƒë·ªÉ d·ªÖ d√†ng thay th·∫ø**

Ch√≠nh v√¨ v·∫≠y, trong tr∆∞·ªùng h·ª£p container ƒë√≥ b·ªã stop (ch∆∞∆°ng tr√¨nh trong container ƒë√≥ b·ªã l·ªói ho·∫∑c g·∫∑p v·∫•n ƒë·ªÅ n√†o ƒë√≥) th√¨ s·∫Ω t·∫°o m·ªõi v√† thay th·∫ø container ƒë√≥. Tuy nhi√™n, d·ªØ li·ªáu trong container h·∫ßu nh∆∞ l√† volatile (nghƒ©a l√† khi container b·ªã ch·∫øt ƒëi thay th·∫ø b·∫±ng container m·ªõi kh√°c th√¨ ƒë·ªìng th·ªùi d·ªØ li·ªáu ƒë√≥ s·∫Ω b·ªã m·∫•t)

<img src="https://github.com/user-attachments/assets/aff8f6d6-6671-40ba-990a-ee29fa6b7803" width="500px" >

ƒê√≥ l√† l√Ω do ch√∫ng ta c·∫ßn Persistent Data ƒë·ªÉ **t√°ch bi·ªát l∆∞u tr·ªØ d·ªØ li·ªáu ra kh·ªèi container**

**ƒê·∫ßu ti√™n c·∫ßn hi·ªÉu c√°ch c∆° ch·∫ø t·∫°o m·ªõi, thay th·∫ø container**

<img src="https://github.com/user-attachments/assets/dc51d43e-b046-4dc3-bb26-8695f8f4f21b" width="500px" >

C·∫•u t·∫°o c·ªßa container g·ªìm c√≥ c√°c layer, trong ƒë√≥: 
- layer m√†u ƒë·ªè l√† layer image (read only)
- layer m√†u xanh l√† writable

> **Khi m√† container ƒë∆∞·ª£c t·∫°o m·ªõi v√† thay th·∫ø th√¨ n√≥ ch·ªâ thay th·∫ø writable v√† gi·ªØ nguy√™n layer image**

> [!NOTE]
> **2 c√°ch t·∫°o Persistent Data**
> - Bind Mount: T·∫°o k·∫øt n·ªëi gi·ªØa th∆∞ m·ª•c trong container v·ªõi th∆∞ m·ª•c trong host
> - Volume

### 2. Bind Mount
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

> **Bind Mount d·ª±a tr√™n m·ªôt kh√°i ni·ªám g·ªçi l√† mouting**

Mouting: g·∫Øn m·ªôt device A v√†o b√™n trong filesystem c·ªßa m·ªôt device B kh√°c. M·ª•c ƒë√≠ch l√† t·ª´ device B c√≥ th·ªÉ nh√¨n th·∫•y, truy c·∫≠p d·ªØ li·ªáu b√™n trong device A

_V√≠ d·ª•:_

C·∫Øm USB (device A) v√†o trong m√°y t√≠nh (device B) th√¨ m·ª•c ƒë√≠ch ·ªü ƒë√¢y l√† trong laptop ta c√≥ th·ªÉ nh√¨n ƒë∆∞·ª£c v√†o file trong device A. Trong tr∆∞·ªùng h·ª£p n√†y l√† th∆∞ m·ª•c **/my-usb** n·∫±m trong filesystem c·ªßa device B n·ªëi filesystem c·ªßa device A (nghƒ©a l√† c√≥ th·ªÉ nh√¨n th·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu c·ªßa usb trong file my-usb tr√™n laptop)

<img src="https://github.com/user-attachments/assets/7b9e6b66-bc22-46e1-9fcc-1d133dc8dfcc" width="500px" >

**V·∫≠y trong container th√¨ ho·∫°t ƒë·ªông nh∆∞ n√†o?**

<img src="https://github.com/user-attachments/assets/1f5f483a-e58e-4a78-8af9-8db1be710bf3" width="500px" >

Host l√† laptop c·ªßa ta ch·ª©a c√°c filesystem, Container c≈©ng ch·ª©a c√°c filesystem c·ªßa ri√™ng n√≥. 

B·∫£n ch·∫•t c·ªßa Bind Mount l√† ta t·∫°o ra m·ªôt th∆∞ m·ª•c **../khalid/nginx** ch·ª©a data tr√™n host (laptop) ƒë∆∞·ª£c l∆∞u tr√™n ch√≠nh hard drive (·ªï c·ª©ng c·ªßa laptop) sau ƒë√≥ s·∫Ω mouting v·ªõi th∆∞ m·ª•c **/app** c·ªßa container. 

K·∫øt qu·∫£ l√† to√†n b·ªô d·ªØ li·ªáu tr√™n th∆∞ m·ª•c **../khalid/nginx** s·∫Ω n·∫±m b√™n trong th∆∞ m·ª•c **/app** c·ªßa container

**C√°ch t·∫°o bind mount**

```
docker container run -v /home/khalid/nginx:/app nginx:latest 
```

- `/home/khalid/nginx`: Th∆∞ m·ª•c tr√™n m√°y host
- `/app`: Th∆∞ m·ª•c tr√™n container
- `$(pwd)`: thay th·∫ø cho ƒë∆∞·ªùng d·∫´n ƒë·∫øn th∆∞ m·ª•c hi·ªán t·∫°i tr√™n m√°y host

_Ch√∫ √Ω:_ N·∫øu th∆∞ m·ª•c ch∆∞a t·ªìn t·∫°i th√¨ Docker s·∫Ω t·ª± ƒë·ªông t·∫°o th∆∞ m·ª•c ƒë√≥

### 3. V√≠ d·ª• v·ªÅ Bind Mount
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

ƒê√¢y l√† th∆∞ m·ª•c d·ª± √°n code c·ªßa ta

![image](https://github.com/user-attachments/assets/c80f2cbb-1d8d-47cc-8066-ce67e092183a)

B√¢y gi·ªù ta s·∫Ω th·ª±c hi·ªán t·∫°o 1 container v√† mount v·ªõi **th∆∞ m·ª•c app** tr√™n container

```
docker run --name docker-ubuntu -d -v $(pwd)/Docker:/app ubuntu sleep infinity
```

![image](https://github.com/user-attachments/assets/15442380-7e46-4ad0-944e-471967e5047a)

B√¢y gi·ªù, ta s·∫Ω ƒëi v√†o trong container `docker-ubuntu` ƒë·ªÉ xem c√≥ t·ªìn t·∫°i **th∆∞ m·ª•c d·ª± √°n code** c·ªßa ta hay kh√¥ng b·∫±ng c√°ch

```
docker container exec -it docker-ubuntu bash
```

![image](https://github.com/user-attachments/assets/4972c0f9-dd10-4af3-b789-c2de0698956f)

Nh∆∞ ta c√≥ th·ªÉ th·∫•y **th∆∞ m·ª•c d·ª± √°n code** c·ªßa ta ƒë√£ ƒë∆∞·ª£c **mount** v·ªõi **th∆∞ m·ª•c app** trong container c√≥ t√™n l√† `docker-ubuntu`

- **Test 1: Thay ƒë·ªïi d·ªØ li·ªáu tr√™n m√°y host** 

Nh∆∞ ch√∫ng ta ƒë∆∞·ª£c bi·∫øt th√¨ n·∫øu nh∆∞ c√≥ s·ª± thay ƒë·ªïi trong **th∆∞ m·ª•c d·ª± √°n code** c·ªßa ta th√¨ ta s·∫Ω ngay l·∫≠p t·ª©c th·∫•y ƒë∆∞·ª£c s·ª± thay ƒë·ªïi tr√™n **th∆∞ m·ª•c app** trong container c√≥ t√™n l√† `docker-ubuntu`

![image](https://github.com/user-attachments/assets/f7d4b78e-b064-452b-8cb6-7e2446dd92fc)

C√¢u l·ªánh b√™n tr√°i l√† ph√≠a host, c√¢u l·ªánh b√™n ph·∫£i l√† ph√≠a container. Ta c√≥ th·ªÉ th·∫•y s·ª± thay ƒë·ªïi ·ªü m√°y host th√¨ trong container c≈©ng ƒë∆∞·ª£c c·∫≠p nh·∫≠t gi·ªëng nh∆∞ v·∫≠y

- **Test 2: Container b·ªã stop ho·∫∑c b·ªã die**

Trong tr∆∞·ªùng h·ª£p container ƒë√≥ b·ªã stop ho·∫∑c b·ªã die th√¨ d·ªØ li·ªáu s·∫Ω kh√¥ng b·ªã x√≥a ƒëi, m√† v·∫´n c√≤n t·ªìn t·∫°i trong m√°y host (M√°y t√≠nh c·ªßa ta)

![image](https://github.com/user-attachments/assets/10e3b97a-c8af-490c-8df7-c70af7826a21)

Nh∆∞ v√≠ d·ª• h√¨nh ·∫£nh tr√™n ta th·ª±c hi·ªán x√≥a container c√≥ t√™n l√† docker-ubuntu, xong ƒë√≥ th·ª±c hi·ªán ki·ªÉm tra l·∫°i d·ªØ li·ªáu tr√™n m√°y host

- **Test 3: Thay ƒë·ªïi d·ªØ li·ªáu tr√™n container**

N·∫øu ta v·∫´n s·ª≠ d·ª•ng c√¢u l·ªánh nh∆∞ ·ªü ph√≠a tr√™n ƒë·ªÉ t·∫°o ra container c√≥ volume

```
docker run --name docker-ubuntu -d -v $(pwd)/Docker:/app ubuntu sleep infinity
```

![image](https://github.com/user-attachments/assets/0b4c75e1-e3bf-4c0b-b05f-efd7c35ce119)

Nh∆∞ tr√™n h√¨nh ·∫£nh, ta c√≥ th·ªÉ th·∫•y ban ƒë·∫ßu ki·ªÉm tra data trong file `newtext` l√† `content from host`, nh∆∞ng tr√™n container ƒë√£ c√≥ quy·ªÅn thay ƒë·ªïi d·ªØ li·ªáu ƒë√≥ th√†nh `content from container`. Ta ki·ªÉm tra tr√™n m√°y host th√¨ c≈©ng th·∫•y ƒëi·ªÅu ƒë√≥.

> [!NOTE]
> **V·∫≠y th√¨ l√†m th·∫ø n√†o ƒë·ªÉ d·ªØ li·ªáu tr√™n m√°y host kh√¥ng b·ªã thay ƒë·ªïi? Nghƒ©a l√† ta mu·ªën container ch·ªâ c√≥ th·ªÉ ƒë·ªçc d·ªØ li·ªáu ƒë∆∞·ª£c mout t·ª´ m√°y host th√¥i**
> Nh∆∞ ch√∫ng ta bi·∫øt khi kh·ªüi t·∫°o m·ªõi 1 container r·∫•t c√≥ th·ªÉ d·ªØ li·ªáu m·ªõi trong container n√†y s·∫Ω ghi ƒë√® l·∫°i d·ªØ li·ªáu c≈© tr√™n m√°y host. 

- **Test 4: Kh√¥ng cho ph√©p thay ƒë·ªïi d·ªØ li·ªáu tr√™n container**

ƒê·ªÉ c·∫•m container c√≥ th·ªÉ thay ƒë·ªïi d·ªØ li·ªáu, th√¨ ta s·ª≠ d·ª•ng th√™m 1 options `:ro` v√†o trong c√¢u l·ªánh

```
docker run --name docker-ubuntu -d -v $(pwd)/Docker:/app:ro ubuntu sleep infinity
```

![image](https://github.com/user-attachments/assets/84a6d61c-8a25-43f0-8ca0-46363637a91f)

Nh∆∞ tr√™n h√¨nh ·∫£nh, ta c√≥ th·ªÉ th·∫•y container kh√¥ng th·ªÉ thay ƒë·ªïi d·ªØ li·ªáu, m√† ch·ªâ c√≥ th·ªÉ ƒë·ªçc (read-only)

- **K·∫øt lu·∫≠n**

![image](https://github.com/user-attachments/assets/f468273a-8135-48a7-8eab-9dce5ae5148a)

Nh∆∞ h√¨nh ·∫£nh tr√™n cho ta th·∫•y, n·∫øu c√≥ nhi·ªÅu container bind mount t·ªõi c√πng 1 ph√¢n v√πng d·ªØ li·ªáu tr√™n m√°y host th√¨ s·ª± thay ƒë·ªïi d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c lan t·ªèa ra c√°c container kh√°c. Nghƒ©a l√† t·∫•t c·∫£ c√°c container c√≥ th·∫ø nh·∫≠n th·∫•y ƒë∆∞·ª£c s·ª± thay ƒë·ªïi d·ªØ li·ªáu ƒë√≥

> [!NOTE]
> - **Bind mount v·ªÅ c∆° b·∫£n l√† vi·ªác d·ªØ li·ªáu tr√™n m√°y host ƒë∆∞·ª£c mount ƒë·∫øn th∆∞ m·ª•c container**
> - **Khi kh·ªüi t·∫°o container, n·∫øu th∆∞ m·ª•c trong container c√≥ d·ªØ li·ªáu, n√≥ s·∫Ω b·ªã overwrite b·ªüi d·ªØ li·ªáu c·ªßa m√°y host**
> - **S·ª≠ d·ª•ng read-only ƒë·ªÉ tr√°nh vi·ªác container thay ƒë·ªïi n·ªôi dung tr√™n host**

### 4. Volume l√† g√¨
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

Volume l√† g√¨:

- **M·ª•c ƒë√≠ch t∆∞∆°ng t·ª± nh∆∞ Bind Mount: N√≥ l∆∞u tr·ªØ v√† b·∫£o v·ªá d·ªØ li·ªáu container khi container ƒë√≥ b·ªã x√≥a ƒëi**
- **Docker ho√†n to√†n qu·∫£n l√Ω volume**
- **C√°ch ho·∫°t ƒë·ªông:** G·∫ßn gi·ªëng v·ªõi bind mount nh∆∞ng v·ªÅ mouting th√¨ theo chi·ªÅu ng∆∞·ª£c l·∫°i. V·ªõi volume th√¨ ta **l·ª±a ch·ªçn ra 1 th∆∞ m·ª•c trong container** r·ªìi √°nh x·∫° m·ªôt v√πng nh·ªõ r·ªìi mouting t·ªõi 1 th∆∞ m·ª•c n√†o ƒë√≥ tr√™n m√°y host

![image](https://github.com/user-attachments/assets/15ce4070-1bd1-49f7-9901-aad5747ac1b3)


- **C√°ch t·∫°o volume:**

![image](https://github.com/user-attachments/assets/865b8152-5738-4b11-83ff-ca5823a3ec1a)

```
docker container run -v ubuntu-data:/app ubuntu:latest
```

Trong ƒë√≥:
 
- `ubuntu-data`: T√™n c·ªßa volume (C√≥ th·ªÉ c√≥ ho·∫∑c kh√¥ng, n·∫øu kh√¥ng ƒë·∫∑t t√™n th√¨ docker s·∫Ω t·ª± t·∫°o gi√∫p ch√∫ng ta 1 anonymous volume v·ªõi name l√† 1 chu·ªói unique)
- `/app`: T√™n th∆∞ m·ª•c c·ªßa container
- T√™n volume c√≥ th·ªÉ l∆∞·ª£c b·ªè n·∫øu volume ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh trong Dockerfile

### 5. V√≠ d·ª• v·ªÅ Volume
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

**Test 1: T·∫°o volume c√≥ t√™n**

T·∫°o m·ªôt container c√≥ t√™n l√† `cvt-nginx` v√† c√≥ volume l√† `nginx-data` b·∫±ng c√¢u l·ªánh sau

```
docker container run --name cvt-nginx -p 81:80 -v nginx-data:/usr/share/html/nginx -d nginx
```

![image](https://github.com/user-attachments/assets/3df830bc-bc81-42de-b80d-a0f971df2160)

C√¢u l·ªánh ƒë·ªÉ li·ªát k√™ c√°c volume t·ªìn t·∫°i trong docker

```
docker volume ls
```

C√¢u l·ªánh ƒë·ªÉ xem th√¥ng tin chi ti·∫øt c·ªßa volume

```
docker volume inspect [volume_name]
```

**Test 2: T·∫°o volume kh√¥ng c√≥ t√™n**

T·∫°o m·ªôt container c√≥ t√™n l√† `cvt-nginx` v√† c√≥ volume nh∆∞ng kh√¥ng ƒë·∫∑t t√™n b·∫±ng c√¢u l·ªánh sau:

```
docker container run --name cvt-nginx -p 81:80 -v /usr/share/html/nginx -d nginx
```

![image](https://github.com/user-attachments/assets/b518d396-caeb-4246-83ab-524f6c02f818)

Nh∆∞ ta c√≥ th·ªÉ th·∫•y volume n√†y ƒë∆∞·ª£c docker t·ª± ƒë·ªông ƒë·∫∑t t√™n cho l√† m·ªôt chu·ªói unique, vi·ªác kh√¥ng ƒë·∫∑t t√™n n√†y s·∫Ω kh√≥ cho vi·ªác qu·∫£n l√Ω volume, n√™n ƒë·∫∑t t√™n cho volume ƒë·ªÉ d·ªÖ qu·∫£n l√Ω h∆°n

ƒê·ªÉ x√≥a volume trong docker volume ta s·ª≠ d·ª•ng c√¢u l·ªánh sau:

```
docker volume rm [volume_name]
```

Khi ta x√≥a container th√¨ volume c·ªßa container ƒë√≥ v·∫´n t·ªìn t·∫°i, vi·ªác c·∫ßn l√†m l√† ch√∫ng ta c·∫ßn ph·∫£i x√≥a 2 l·∫ßn: x√≥a container xong x√≥a volume. Nh∆∞ v·∫≠y ch∆∞a t·ªëi ∆∞u l·∫Øm, ng∆∞·ªùi ta c√≥ th·ªÉ s·ª≠ d·ª•ng `--rm` trong l√∫c kh·ªüi t·∫°o container. Khi m√† container b·ªã x√≥a ƒëi th√¨ volume ƒë√≥ s·∫Ω ƒë·ªìng th·ªùi b·ªã x√≥a ƒëi theo

```
docker container run --name cvt-nginx -p 81:80 --rm -v /usr/share/html/nginx -d nginx
```

**Test 3: T·∫°o volume kh√¥ng c·∫ßn option `-v`**

_V√≠ d·ª•:_ T·∫°o m·ªôt docker cho database mysql:8.0

```
docker container run --name cvt-mysql -e MYSQL_ROOT_PASSWORD=password123 -e MYSQL_DATABASE=db_example -d mysql:8.0
```

![image](https://github.com/user-attachments/assets/54bb9e35-1222-48c5-b13d-12166cba7590)

Ch√∫ng ta c√≥ th·ªÉ th·∫•y ta t·∫°o docker volume kh√¥ng c·∫ßn ƒë·∫øn option `-v`. L√≠ do t·∫°i sao l·∫°i nh∆∞ v·∫≠y?. **Trong qu√° tr√¨nh docker image mysql:8.0 n√†y th√¨ Dockerfile c·ªßa n√≥ ƒë√£ ch·ªâ ƒë·ªãnh volume ·ªü trong ƒë√≥**. ƒê·ªÉ ki·ªÉm tra th√¨ ch√∫ng ta c√≥ th·ªÉ l√™n DockerHub t√¨m t·ªõi phi√™n b·∫£n **mysql:8.0** c√≥ th·ªÉ th·∫•y trong Dockerfile ƒë√£ ch·ªâ ƒë·ªãnh volume ·ªü trong ƒë√≥ r·ªìi.

![image](https://github.com/user-attachments/assets/644a2b85-75a0-4489-97e9-73eac1db292c)

> [!NOTE]
> **V·∫≠y ch√∫ng ta c√≥ 2 c√°ch ƒë·ªÉ t·∫°o ra docker volume:**
> - **T·∫°o tr·ª±c ti·∫øp b·∫±ng c√¢u l·ªánh v·ªõi option `-v`**
> - **T·∫°o gi√°n ti·∫øp b·∫±ng c√°ch ch·ªâ ƒë·ªãnh volume trong Dockerfile, kh√¥ng c·∫ßn s·ª≠ d·ª•ng option `-v`**

**C√¢u h·ªèi l√†m sao ƒë·ªÉ bi·∫øt ƒë∆∞·ª£c docker image c√≥ volume ·ªü b√™n trong kh√¥ng v√† volume ƒë√≥ n·∫±m ·ªü th∆∞ m·ª•c n√†o?**

Ch√∫ng ta s·ª≠ d·ª•ng c√¢u l·ªánh sau:

```
docker image inspect [image_name] | grep -A 2 Volume
```

![image](https://github.com/user-attachments/assets/ba070487-87e6-4e2b-bdba-1ebb817031e2)

![image](https://github.com/user-attachments/assets/84306fea-aafc-4292-97c7-64ce3cbeb94d)

Nh∆∞ ch√∫ng ta c√≥ th·ªÉ th·∫•y **mysql c√≥ volume**, nginx th√¨ kh√¥ng c√≥ volume (hi·ªÉn th·ªã l√† null)

**T∆∞∆°ng t·ª± ta c≈©ng c√≥ th·ªÉ ki·∫øm tra xem container b·∫•t k·ª≥ c√≥ volume b√™n trong kh√¥ng?**

Ch√∫ng ta s·ª≠ d·ª•ng c√¢u l·ªánh sau:

```
docker container inspect [container_name] | grep -A 3 Mounts
```

![image](https://github.com/user-attachments/assets/b420df54-8d85-418c-9cfd-6f392d4ee334)


**V√≠ d·ª• kh√°c**

Ta s·∫Ω t·∫°o ra 1 Dockerfile c√≥ n·ªôi dung nh∆∞ sau

```Dockerfile
FROM nginx

VOLUME [ "/data"]
VOLUME [ "/data2"]
VOLUME [ "/data3"]

EXPOSE 80
```

D√πng ƒë·ªÉ t·∫°o ra 1 image c√≥ 3 volume l√† `data`, `data2`, `data3`

![image](https://github.com/user-attachments/assets/f831ad15-a212-4993-ac49-32a9e2dad1c0)

Sau ƒë√≥ ta s·∫Ω th·ª±c hi·ªán t·∫°o ra container b·∫±ng c√¢u l·ªánh

```bash
docker container run --name cvt-nginx -p 81:80 -d -v data1:/data -v data2:/data2 -v data3:/data3 demo-nginx
```

![image](https://github.com/user-attachments/assets/172d76c3-d50a-47d3-ad38-dfc48e4cbed5)

Nh∆∞ ch√∫ng ta c√≥ th·ªÉ th·∫•y gi·ªù container n√†y c√≥ 3 volume l√† `data`, `data2`, `data3`

B√¢y gi·ªù th·ª±c hi·ªán t·∫°o ra 1 container kh√°c mount v·ªõi volume `data`

```
docker container run --name cvt-nginx2 -p 82:80 -d -v data1:/data nginx
```

![image](https://github.com/user-attachments/assets/06bf345e-0164-4d6b-9bed-6dd4356e488e)

![image](https://github.com/user-attachments/assets/060113dc-c9a1-45bf-ae0e-b56e14d2444f)

Nh∆∞ v·∫≠y ch√∫ng ta c√≥ th·ªÉ hi·ªÉu r·∫±ng 2 container `cvt-nginx` v√† `cvt-nginx2` ƒëang s·ª≠ d·ª•ng chung volume `data`, ch√∫ng c√≥ th·ªÉ chia s·∫ª d·ªØ li·ªáu v·ªõi nhau

![image](https://github.com/user-attachments/assets/0e25c09d-ac7e-4898-b455-cce26113a088)

**C√¢u h·ªèi: B√¢y gi·ªù ta kh√¥ng bi·∫øt ƒë∆∞·ª£c volume c·ªßa container tr∆∞·ªõc n·∫±m ·ªü ƒë√¢u, ta mu·ªën t·∫°o 1 container m·ªõi c√≥ t·∫•t c·∫£ volume c·ªßa container tr∆∞·ªõc ƒë√≥ th√¨ sao?**

Docker ƒë√£ cung c·∫•p s·∫µn cho ch√∫ng ta 1 option `--volumes-from`

![image](https://github.com/user-attachments/assets/f9d9fbd9-fd09-4fe7-9f0c-075bf87904f5)

Nh∆∞ v·∫≠y th√¨ container `cvt-nginx3` s·∫Ω d√πng 3 volume `data`, `data2`, `data3` c·ªßa `cvt-nginx`

![image](https://github.com/user-attachments/assets/d2c78139-8258-4628-bffe-12400d3645c8)

### 6. Bind mount vs Volume
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

| Bind mount | Volume |
| :---: | :---: |
| Ph·ª• thu·ªôc v√†o filesystem c·ªßa host | Kh√¥ng ph·ª• thu·ªôc v√†o filesystem c·ªßa host |
| Kh√¥ng c√≥ driver | C√≥ driver, cho ph√©p l∆∞u data l√™n cloud, remote host | 
| Ta l·ª±a ch·ªçn th∆∞ m·ª•c tr√™n host ƒë·ªÉ mount | Docker l·ª±a ch·ªçn th∆∞ m·ª•c tr√™n m√°y host | 
| Bind mount ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh khi run command | Volume c√≥ th·ªÉ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh khi run command ho·∫∑c trong Dockerfile |
| D·ªØ li·ªáu trong container c√≥ th·ªÉ b·ªã ghi ƒë√® khi kh·ªüi t·∫°o | D·ªØ li·ªáu trong container kh√¥ng b·ªã ghi ƒë√® khi kh·ªüi t·∫°o |

ƒê·ªëi v·ªõi Bind mount: **D·ªØ li·ªáu trong container c√≥ th·ªÉ b·ªã ghi ƒë√® khi kh·ªüi t·∫°o** l√† m·ªôt ƒëi·ªÅu kh√¥ng t·ªët ƒë·ªëi v·ªõi container database. V√≠ d·ª• nh∆∞ ta t·∫°o 1 container mysql n·∫øu m√† khi bind mount th√¨ data trong mysql c√≥ th·ªÉ b·ªã ghi ƒë√® s·∫Ω d·∫´n ƒë·∫øn t√≠nh tr·∫°ng container ƒë√≥ kh√¥ng th·ªÉ ho·∫°t ƒë·ªông ƒë∆∞·ª£c. Do mysql c·∫ßn c√≥ data ban ƒë·∫ßu ƒë·ªÉ c√≥ th·ªÉ kh·ªüi t·∫°o, trong tr∆∞·ªùng h·ª£p n√†y b·∫Øt bu·ªôc ph·∫£i s·ª≠ d·ª•ng volume

### 7. Utility containers
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

- L√† c√°c container m√¥i tr∆∞·ªùng, gi√∫p ta ch·∫°y ch∆∞∆°ng tr√¨nh (programs), th·ª≠ nghi·ªám m√¥ h√¨nh
- Bi·ªÉn Docker tr·ªü th√†nh c√¥ng c·ª• v√¥ c√πng hi·ªáu qu·∫£ cho m·ªçi b√†i to√°n test app, tri·ªÉn khai th·ª≠ m√¥i tr∆∞·ªùng

**Hi·ªÉu ƒë∆°n gi·∫£n l√†:** B√¨nh th∆∞·ªùng ƒë·ªÉ ch·∫°y ƒë∆∞·ª£c ch∆∞∆°ng tr√¨nh ta c·∫ßn c√†i th∆∞ vi·ªán (c√†i m√¥i tr∆∞·ªùng) tr·ª±c ti·∫øp tr√™n m√°y host (m√°y t√≠nh c·ªßa ta). Nh∆∞ng n·∫øu s·ª≠ d·ª•ng Docker th√¨ ta kh√¥ng c·∫ßn ph·∫£i c√†i tr·ª±c ti·∫øp v√†o m√°y host n·ªØa, m√† ta ch·ªâ c·∫ßn ch·∫°y ch∆∞∆°ng tr√¨nh ƒë√≥ th√¥ng qua Docker.

_V√≠ d·ª•:_ B√¢y gi·ªù t√¥i mu·ªën ch·∫°y ch∆∞∆°ng tr√¨nh nodejs n√†y. Hi·ªán t·∫°i ch∆∞a c√†i ƒë·∫∑t th∆∞ vi·ªán `express`. T√¥i mu·ªën ch·∫°y ch∆∞∆°ng tr√¨nh n√†y s·ª≠ d·ª•ng docker thay v√¨ ph·∫£i c√†i tr·ª±c ti·∫øp tr√™n m√°y host

![image](https://github.com/user-attachments/assets/5bdecb45-a07a-4744-8201-a95cfcde51f0)

Th·ª±c hi·ªán t·∫°o Dockerfile ƒë·ªÉ c·∫•u h√¨nh phi√™n b·∫£n Nodejs

```
FROM node:latest
VOLUME ["/app"]
ENTRYPOINT ["tail", "-f", "/dev/null"]
```

![image](https://github.com/user-attachments/assets/2c02b1a0-ea99-4703-aed2-b6db4b41e066)

Sau ƒë√≥ ta th·ª±c hi·ªán t·∫°o ra container s·ª≠ d·ª•ng bind mount ƒë·ªÉ mouting th∆∞ m·ª•c code `cvt-node` tr√™n m√°y host v·ªõi th∆∞ m·ª•c `app` tr√™n container

![image](https://github.com/user-attachments/assets/ad15d081-f5fc-4b7b-b73a-9e2759196b99)

Trong container ta th·ª±c hi·ªán c√†i ƒë·∫∑t `npm install express` nh∆∞ b√¨nh th∆∞·ªùng 

![image](https://github.com/user-attachments/assets/4d3b4e8f-27ea-4f45-bb11-622caad157b8)

Sau ƒë√≥ th·ª±c hi·ªán ch·∫°y `index.js`

![image](https://github.com/user-attachments/assets/f40daea8-bb42-496c-93cd-fcefb7a44e5c)

## IV. Docker network
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

### 1. C√°c kh√°i ni·ªám c∆° b·∫£n
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

- Networking l√† t·∫≠p h·ª£p c√°c m√°y t√≠nh v√† c√°c k·∫øt n·ªëi cho ph√©p c√°c m√°y t√≠nh giao ti·∫øp v·ªõi nhau
- Trong docker, virtual network cho ph√©p container t∆∞∆°ng t√°c v·ªõi th·∫ø gi·ªõi b√™n ngo√†i
- NAT (Network Address Translation) l√† qu√° tr√¨nh chuy·ªÉn ƒë·ªïi ƒë·ªãa ch·ªâ IP th∆∞·ªùng l√† t·ª´ Private IP sang Public IP

C√¥ng vi·ªác NAT th∆∞·ªùng ƒë∆∞·ª£c di·ªÖn ra ·ªü c√°c thi·∫øt b·ªã v√≠ d·ª• nh∆∞ router

D∆∞·ªõi ƒë√¢y l√† m√¥ ph·ªèng m√¥ h√¨nh m·∫°ng c∆° b·∫£n

![image](https://github.com/user-attachments/assets/523525d1-4f79-49c2-bf4e-bef40c0bf5c6)

C√≤n d∆∞·ªõi ƒë√¢y l√† m√¥ ph·ªèng m√¥ h√¨nh m·∫°ng trong docker

![image](https://github.com/user-attachments/assets/2ded91dc-121b-4463-8da5-287313d340eb)

NAT ·ªü ƒë√¢y ch√≠nh l√† t∆∞·ªùng l·ª≠a ·ªü tr√™n m√°y t√≠nh, th·ª±c ch·∫•t ƒë∆°n gi·∫£n l√† ip table (c√°c quy t·∫Øc trong ip table ƒë·ªÉ quy ƒë·ªãnh l√†m sao c√°c lu·ªìng traffic n√≥ c√≥ ƒëi ƒë∆∞·ª£c v√†o trong container n√†y hay kh√¥ng.

_V√≠ d·ª• 1:_ Th√¥ng th∆∞·ªùng ch√∫ng ta ch·∫°y c√¢u l·ªánh ƒë∆°n gi·∫£n nh∆∞ n√†y ƒë·ªÉ ch·∫°y contaienr

```bash
docker container run -p 80:81 nginx
```

![image](https://github.com/user-attachments/assets/4fa46500-77e4-4692-b909-e9fa1bf89886)

Th·ª±c ch·∫•t th√¨ docker ƒë√£ t·∫°o cho ch√∫ng ta s·∫µn 1 m·∫°ng network c√≥ t√™n l√† **brigde network**. Khi m√† ch√∫ng ta t·∫°o container m√† kh√¥ng ch·ªâ ƒë·ªãnh m·∫°ng th√¨ m·∫∑c ƒë·ªãnh docker s·∫Ω kh·ªüi t·∫°o container ƒë√≥ s·ª≠ d·ª•ng m·∫°ng **brigde network** n√†y

![image](https://github.com/user-attachments/assets/821e0867-00a1-49b2-b82e-ae4bdafb36c9)

Khi m√† container nginx n√†y ƒë∆∞·ª£c t·∫°o ra, th√¨ n√≥ s·∫Ω ƒë∆∞·ª£c c·∫•p 1 ƒë·ªãa ch·ªâ ip thu·ªôc d·∫£i ƒë·ªãa ch·ªâ ip c·ªßa m·∫°ng **brigde network** n√†y. `-p 80:81` ·ªü ƒë√¢y c√≥ nghƒ©a l√† publish cho ph√©p t·∫•t c·∫£ traffic v√†o b√™n trong c·ªïng 80 tr√™n m√°y t√≠nh r·ªìi n√≥ chuy·ªÉn ƒë·∫øn c·ªïng 80 tr√™n container.

> [!NOTE]
> - **Default network l√† bridge network**
> - **M·∫∑c ƒë·ªãnh, khi t·∫°o container, t·∫•t c·∫£ port s·∫Ω ƒë∆∞·ª£c private (kh√¥ng public ra ngo√†i)**
> - **-p (publish) cho ph√©p bind port c·ªßa container v·ªõi port c·ªßa m√°y host**

**Li·ªáu ch√∫ng ta c√≥ th·ªÉ t·∫°o ra network ri√™ng ƒë∆∞·ª£c kh√¥ng?**

C√∫ ph√°p t·∫°o ra network ri√™ng:

```bash
docker container run -p 81:80 --network custom -d [image_name]
```

![image](https://github.com/user-attachments/assets/3271b0b9-261b-4d24-bbfb-6835d79035cd)

Ch√∫ √Ω: Kh√¥ng th·ªÉ s·ª≠ d·ª•ng 2 ch∆∞∆°ng tr√¨nh tr√™n c√πng 1 c·ªïng

_V√≠ d·ª• 2:_ Th·ª≠ t·∫°o nghi·ªám t·∫°o docker network b·∫±ng c√¢u l·ªánh

![image](https://github.com/user-attachments/assets/afe13110-a37f-4b07-91a5-72a5861d5c9f)

ƒê·∫ßu ti√™n s·ª≠ d·ª•ng c√¢u l·ªánh t·∫°o docker nh∆∞ b√¨nh th∆∞·ªùng

```bash
docker container run --name cvt-nginx -p 80:80 -d nginx
```

![image](https://github.com/user-attachments/assets/8273a34b-1336-4d0a-83c1-f4b5ad5c56fa)

Xong ƒë√≥ ki·ªÉm tra b·∫±ng c√°ch c√¢u l·ªánh sau

```bash
docker network ls
docker network inspect [network_name]
```

Ch√∫ng ta c√≥ th·ªÉ th·∫•y ƒë·ªãa ch·ªâ subnet c·ªßa m·∫°ng bridge network l√† **172.17.0.0/16** v·ªõi gateway **172.17.0.1**, container `cvt-nginx` c√≥ ƒë·ªãa ch·ªâ network l√† **172.17.0.2/16** thu·ªôc d·∫£i ƒë·ªãa ch·ªâ c·ªßa m·∫°ng bridge network

ƒê·ªÉ t·∫°o ra 1 network m·ªõi, ta s·ª≠ d·ª•ng c√¢u l·ªánh

```bash
docker network create [network_name]
```

![image](https://github.com/user-attachments/assets/13a2bb35-06cb-4bb0-b270-937f232a0df3)

### 2. Bridge v√† custom network
[:arrow_up: M·ª•c l·ª•c](#m·ª•c-l·ª•c)

ƒê·ªÉ c√≥ th·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ ph·∫ßn n√†y, ta c√≥ v√≠ d·ª• sau: V√≠ d·ª• n√†y ta t·∫°o ra 2 con container mysql thu·ªôc 2 m·∫°ng kh√°c nhau l√† brigde network v√† custom network. Xong ƒë√≥ ta s·∫Ω th·ª±c hi·ªán ping gi·ªØa 2 container nginx v√† mysql

![image](https://github.com/user-attachments/assets/d6380760-f230-46b9-9788-47b9af9d3716)

Th·ª±c hi·ªán 2 l·ªánh sau ƒë·ªÉ t·∫°o ra 2 container mysql cho 2 m·∫°ng bridge v√† custom network

```bash
docker container run --name cvt-mysql -e MYSQL_ROOT_PASSWORD=password123 -e MYSQL_DATABASE=db_example -d mysql:8.0
docker container run --name cvt-mysql-custom -e MYSQL_ROOT_PASSWORD=password123 -e MYSQL_DATABASE=db_example -d --network custom mysql:8.0
```

![image](https://github.com/user-attachments/assets/9731d328-8c95-4d02-83d8-2c33d94fd9d0)

| Bridge network | Custom network |
| :--: | :--: |
| ![image](https://github.com/user-attachments/assets/ef71c38a-007a-430e-b6fb-144d3227ed03) | ![image](https://github.com/user-attachments/assets/c17a1b2c-89a8-43d5-85e5-fc9f2f863ff0) |

B√¢y gi·ªù ta s·∫Ω ƒëi v√†o trong container `cvt-nginx` b·∫±ng `docker container exec -it cvt-nginx bash`. Xong ƒë√≥ ch√∫ng ta c·∫ßn c√†i **ping** nh∆∞ sau

```bash
apt update
apt upgrade
apt install iputils-ping
```

![image](https://github.com/user-attachments/assets/16171d14-5224-442b-a7af-6fd29fadae08)

![image](https://github.com/user-attachments/assets/494e6c23-5a01-4543-ad25-14a21103d08f)

ƒê·ªÉ c√≥ th·ªÉ ping ƒë∆∞·ª£c th√¨ s·ª≠ d·ª•ng `ping [ip]`

_V√≠ d·ª•:_ Ping t·ª´ container **cvt-nginx** ƒë·∫øn **cvt-mysql**

```
ping 172.17.0.3
```

![image](https://github.com/user-attachments/assets/1ce7d30d-a317-4763-a648-1081d70567f9)

Nh∆∞ v·∫≠y k·∫øt n·ªëi t·ª´ **cvt-nginx** ƒë·∫øn **cvt-mysql** ƒë√£ ƒë∆∞·ª£c th√¥ng

**V·∫≠y k·∫øt n·ªëi t·ª´ **cvt-mysql** ƒë·∫øn **cvt-nginx** th√¨ sao**

L√†m t∆∞∆°ng t·ª± ta s·∫Ω ƒëi v√†o trong container `cvt-mysql` b·∫±ng `docker container exec -it cvt-mysql bash`. **Ch√∫ √Ω r·∫±ng mysql kh√¥ng s·ª≠ d·ª•ng `apt`, `yum` m√† s·ª≠ d·ª•ng `microdnf`**

